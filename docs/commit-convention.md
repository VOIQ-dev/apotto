# コミットメッセージ規約

## 目的
- コミット履歴の可読性向上
- 変更内容の追跡を容易に
- 自動化ツール（CHANGELOG生成など）との連携
- レビュープロセスの効率化

## 基本フォーマット

```
<type>: <subject>

[optional body]

[optional footer]
```

## Type（必須）

| Type | 説明 | 例 |
|------|------|-----|
| `feat` | 新機能追加 | `feat: PDF閲覧追跡機能を追加` |
| `fix` | バグ修正 | `fix: ログインセッションのタイムアウトエラーを修正` |
| `refactor` | リファクタリング（機能変更なし） | `refactor: PDF処理ロジックを整理` |
| `perf` | パフォーマンス改善 | `perf: データベースクエリを最適化` |
| `style` | コードスタイル修正（動作に影響なし） | `style: インデント修正` |
| `docs` | ドキュメント変更のみ | `docs: README更新` |
| `test` | テストの追加・修正 | `test: ユーザー認証のテスト追加` |
| `chore` | 雑務（依存関係更新など） | `chore: パッケージ更新` |
| `build` | ビルドシステムや依存関係の変更 | `build: webpack設定変更` |
| `ci` | CI設定の変更 | `ci: GitHub Actions追加` |

## Subject（件名）のルール

1. **言語**: 日本語を推奨（プロジェクトの主要言語に合わせる）
2. **長さ**: 50文字以内を目安に
3. **句点**: 文末に句点（。）は不要
4. **動詞**: 「〜を追加」「〜を修正」など、動作を明確に
5. **大文字**: typeの後は小文字で開始

### 良い例
```
feat: Stripe決済機能を追加
fix: PDFアップロード時の文字化けを修正
refactor: 認証ロジックをミドルウェアに移動
```

### 悪い例
```
重い処理を改善対応  // typeが無い
feat: いろいろ修正した  // 何をしたか不明確
fix: バグ修正。  // 句点が不要、内容が曖昧
```

## Body（本文）- オプション

詳細な説明が必要な場合に記述：

- **なぜ**この変更が必要か
- **何が**変わったか
- **どのように**実装したか

### 例
```
feat: PDF閲覧追跡機能を追加

営業担当者が顧客のPDF閲覧状況を把握できるように追跡機能を実装。

実装内容:
- トークンベースの追跡リンク生成
- 閲覧進捗のリアルタイム記録API
- ダッシュボードでの閲覧状況表示
- 30日間のデータ保持ポリシー
```

## Footer（フッター）- オプション

### Breaking Changes（破壊的変更）
```
feat: 認証システムをJWTに移行

BREAKING CHANGE: セッションベースの認証を廃止。
既存のセッションは無効になります。
```

### Issue参照
```
fix: ユーザー登録時のエラーハンドリング改善

Closes #123
Refs #124
```

## 実践例

### 単純な変更
```
fix: ログインボタンのスタイル修正
```

### 詳細な変更
```
feat: Backoffice管理画面を追加

企業管理者がアカウント管理を行うためのBackoffice機能を実装。

実装内容:
- 企業一覧・詳細画面
- アカウント作成・編集・削除機能
- 認証ミドルウェア（JWT）
- パスワードリセット機能

Closes #45
```

### 複数ファイルの変更
```
refactor: API routeをディレクトリ構造で整理

可読性向上のため、API routeを機能ごとにディレクトリ分割:
- /api/auth/* - 認証関連
- /api/pdf/* - PDF操作
- /api/billing/* - 決済関連
- /api/backoffice/* - 管理画面
```

## コミット粒度のガイドライン

### 良い粒度
- 1つの機能または修正に1コミット
- レビュー可能な適切なサイズ
- ビルドが通る状態

### 避けるべき
- 複数の無関係な変更を1コミットに含める
- 過度に細かすぎるコミット（typo修正を10個に分けるなど）
- ビルドが壊れた状態でコミット

## チェックリスト

コミット前に確認：

- [ ] typeは適切か
- [ ] subjectは50文字以内か
- [ ] 変更内容が明確に伝わるか
- [ ] ビルドが通るか
- [ ] Lintエラーがないか
- [ ] 不要なファイル（.env、logsなど）を含んでいないか

## 参考
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Angular Commit Message Guidelines](https://github.com/angular/angular/blob/main/CONTRIBUTING.md#commit)
